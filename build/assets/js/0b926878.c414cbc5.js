"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4687],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),h=r,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return n?i.createElement(m,a(a({ref:t},c),{},{components:n})):i.createElement(m,a({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,a[1]=s;for(var u=2;u<o;u++)a[u]=n[u];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},28956:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var i=n(87462),r=(n(67294),n(3905));const o={},a="Authentication",s={unversionedId:"Authentication",id:"Authentication",title:"Authentication",description:"In the following section we make an introduction to the technical specification and usage of our authentication system.",source:"@site/docs/04-Authentication.mdx",sourceDirName:".",slug:"/Authentication",permalink:"/OpenLeakedDocs/docs/Authentication",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Backend",permalink:"/OpenLeakedDocs/docs/Backend"},next:{title:"Frontend",permalink:"/OpenLeakedDocs/docs/Frontend"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Types of security",id:"types-of-security",level:2},{value:"The security chain",id:"the-security-chain",level:2},{value:"Default usage",id:"default-usage",level:2}],c={toc:u};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"In the following section we make an introduction to the technical specification and usage of our authentication system. "),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"We make use of authentication for two reasons - simulate the usage of the Single Sign on from DTU and rate limiting.\nThe latter will be specified in its own section. "),(0,r.kt)("h2",{id:"types-of-security"},"Types of security"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-security/reference/index.html"},"Spring security")," contains many methods for securing an application. We make use of libraries to be consistant with the usage of Spring Boot,\nbut an added benefit is the fact that their implementation is better and more secure compared to what we would be able to write ourselves. "),(0,r.kt)("p",null,"Specified in the Datbase section we make us of a simple SQL server to handle our users and their permissions - which is being used by ",(0,r.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/jdbc.html"},"JDBC Connection")," to handle authentication.\nThis includes hashing passwords and adding salt. This is done using the ",(0,r.kt)("inlineCode",{parentName:"p"},"BCRYPT Algorithm"),"."),(0,r.kt)("p",null,"The security type we define is based on sessions. Meaning that once a user is verified they are authorized temporarily using a session Cookie.\nUpon expiration the user would have to sign in again. "),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"}," Spring Security 3.1.1")," has no support for setting the SamSite cookie attribute used to handle CSRF.\nTo get around this the attribute is set in Nginx. ")),(0,r.kt)("h2",{id:"the-security-chain"},"The security chain"),(0,r.kt)("p",null,"All requests in the application goes through the ",(0,r.kt)("inlineCode",{parentName:"p"},"Security Filter Chain")," in the backend.\nIn here we define which REST API endpoints are allowed without being authorised.\nTo add more endpoints to the filter chain or in general change the security config edit the  ",(0,r.kt)("inlineCode",{parentName:"p"},"SecurityConfig")," file. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/*\n    |\n    |\n    |\n    |\n*/\n return http\n                .csrf((csrf) -> csrf\n                        .csrfTokenRepository(tokenRepository)\n                        .csrfTokenRequestHandler(requestHandler)\n                )\n                .httpBasic((basic) -> basic\n                        // Custom response header to avoid default browser login behavior\n                        .authenticationEntryPoint(new LoginEntryPoint())\n                        .addObjectPostProcessor(new ObjectPostProcessor<BasicAuthenticationFilter>() {\n                            @Override\n                            public <O extends BasicAuthenticationFilter> O postProcess(O filter) {\n                                filter.setSecurityContextRepository(httpSessionSecurityContextRepository);\n                                return filter;\n                            }\n                        }))\n                .authorizeHttpRequests((requests) -> requests\n                        .requestMatchers(HttpMethod.POST, "/api/login/login", "/api/login/recover", "/api/login/register", "/api/login/recover").permitAll()\n                        .requestMatchers(HttpMethod.PUT, "/api/login/verify", "/api/login/newPassword").permitAll()\n                        .requestMatchers(HttpMethod.GET, "/api/csrf", "/api/login/logout", "/api/breaches/all").permitAll()\n                        .anyRequest().authenticated()\n                )\n                .logout(logout -> logout\n                        .logoutUrl("/api/logout")\n                        .invalidateHttpSession(true)\n                        .logoutSuccessUrl("/api/csrf")\n                )\n                .build()\n                ;\n')),(0,r.kt)("p",null,"In the code snippet above we define the implementation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Security Filter Chain"),".\nInitially we enable CrossSiteRequestForgery of which we add the ",(0,r.kt)("a",{parentName:"p",href:"https://swagger.io/docs/specification/authentication/basic-authentication/"},"HTTP basic")," authentication type. "),(0,r.kt)("p",null,"We define a new entrypoint ",(0,r.kt)("inlineCode",{parentName:"p"},"LoginEntryPoint")," to disable build in ",(0,r.kt)("inlineCode",{parentName:"p"},"WWW-Authentication")," headers and status codes from browsers disabling default forms. "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},' @Override\n    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authEx) throws IOException {\n        response.addHeader("X-CUSTOM-AUTHENTICATE", "Basic realm=\\"" + getRealmName() + "\\"");\n        response.addHeader("Content-Type", "text/html; charset=utf-8");\n        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n        PrintWriter writer  = response.getWriter();\n        writer.println("HTTP Status 401 - " + authEx.getMessage());\n    }\n')),(0,r.kt)("p",{parentName:"admonition"},"Construction of the custom response to the ",(0,r.kt)("inlineCode",{parentName:"p"},"LoginEntryPoint"),".")),(0,r.kt)("p",null,"Lastly we define the ",(0,r.kt)("inlineCode",{parentName:"p"},"authorizedHttpRequests")," on a request ",(0,r.kt)("em",{parentName:"p"},"TYPE")," basis, i.e,, POST, PUT and GET and their endpoints allowed without authoirsation.\nIf any other endpoint is reached they are met with the ",(0,r.kt)("inlineCode",{parentName:"p"},"LoginEntryPoint")," request headers and redirected to the Sign in page. "),(0,r.kt)("p",null,"Similarily we ensure that the ",(0,r.kt)("inlineCode",{parentName:"p"},"Security Filter Chain")," listens for any HTTP basic logout type to sign the user out and revoke a session token. "),(0,r.kt)("h2",{id:"default-usage"},"Default usage"),(0,r.kt)("p",null,"Per default no users are added - This means there are currently no users with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Admin")," user role.\nIn future versions a great implementation would be to implement a user panel allowing users to edit their information, and perhabs upload data if they had a certain role. "),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Implementation of user roles may be added with SSO (Single Sign on) of DTU")))}p.isMDXComponent=!0}}]);