"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[78],{65843:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var n=t(87462),i=(t(67294),t(3905));const r={sidebar_position:1},s="MariaDB - Persistent storage",o={unversionedId:"Database/MariaDB",id:"Database/MariaDB",title:"MariaDB - Persistent storage",description:"In this section we aim to provide usefull insight into the design decisions for the databases.",source:"@site/docs/02-Database/MariaDB.md",sourceDirName:"02-Database",slug:"/Database/MariaDB",permalink:"/OpenLeakedDocs/docs/Database/MariaDB",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/OpenLeakedDocs/docs/Database/Introduction"},next:{title:"Redis - Cache",permalink:"/OpenLeakedDocs/docs/Database/Cache"}},l={},d=[{value:"Loading the schemas",id:"loading-the-schemas",level:2},{value:"Design thoughts",id:"design-thoughts",level:2},{value:"Data",id:"data",level:3},{value:"Authorisations",id:"authorisations",level:3},{value:"Future works",id:"future-works",level:4}],u={toc:d};function h(e){let{components:a,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},u,r,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"mariadb---persistent-storage"},"MariaDB - Persistent storage"),(0,i.kt)("p",null,"In this section we aim to provide usefull insight into the design decisions for the databases.\nWe also here define basic schemas used to deploy the project."),(0,i.kt)("p",null,"The database is based on a SQL database in MariaDB.\nTherefor the entity relationships are important. If improperly design they would slow down the application and vice versa."),(0,i.kt)("p",null,"The database evolves around one ",(0,i.kt)("inlineCode",{parentName:"p"},"schema"),"."),(0,i.kt)("p",null,"The entity relationships are freely available here for the interrested users:"),(0,i.kt)("blockquote",null,(0,i.kt)("ol",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{target:"_blank",href:t(53182).Z},"Entity Relationship diagram for users"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{target:"_blank",href:t(34641).Z},"Entity Relationship diagram for data"))))),(0,i.kt)("h2",{id:"loading-the-schemas"},"Loading the schemas"),(0,i.kt)("p",null,"To start the Docker containers the ",(0,i.kt)("inlineCode",{parentName:"p"},"schema")," of the database is important.\nTo get you started we have provided that in SQL form here."),(0,i.kt)("p",null,"Essentially the following snippet creates the tables in the database and adds constraints to values, assigns primary keys and foregin keys."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"DROP DATABASE IF EXISTS OPEN_LEAKED;\n\nCREATE DATABASE OPEN_LEAKED;\n\nUSE OPEN_LEAKED;\n\ncreate table breach\n(\n    id            serial primary key,\n    date          date         null,\n    inserted_date date         not null,\n    name          varchar(255) not null,\n    source        varchar(255) null,\n    verified      boolean      not null,\n    iconURL       varchar(255) null,\n    summary       text         null,\n    description   text         null\n);\n\ncreate table email\n(\n    id     serial primary key,\n    domain varchar(255) not null,\n    local  varchar(255) not null\n);\n\ncreate table email_breaches\n(\n    email_id    bigint unsigned not null,\n    breaches_id bigint unsigned not null\n);\n\ncreate table password\n(\n    id    serial unique primary key,\n    value varchar(255) not null\n);\n\ncreate table password_breaches\n(\n    password_id bigint unsigned not null,\n    breaches_id bigint unsigned not null\n);\n\ncreate table username\n(\n    id    serial unique primary key ,\n    value varchar(255) not null\n);\n\ncreate table username_breaches\n(\n    username_id bigint unsigned not null,\n    breaches_id bigint unsigned not null\n);\n\ncreate table subscription\n(\n    domain varchar(255) not null,\n    local  varchar(255) not null,\n    primary key (domain, local)\n);\n\ncreate table tip\n(\n    link varchar(255) primary key,\n    description varchar(255) null,\n    size        int,\n    unit        varchar(255) null,\n    breach_date date         null\n);\n\n\ncreate table users\n(\n    username   varchar(50)       not null\n        primary key,\n    password   varchar(100)      not null,\n    enabled    tinyint default 1 not null\n);\n\n\n\ncreate table authorities\n(\n    username  varchar(50) not null,\n    authority varchar(50) not null,\n    constraint ix_auth_username\n        unique (username, authority),\n    constraint authorities_ibfk_1\n        foreign key (username) references OPEN_LEAKED.users (username)\n);\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The following assumes that you've created the ",(0,i.kt)("inlineCode",{parentName:"p"},"schema"),"\nIf not enter the following containerized"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE SCHEMA IF NOT EXISTS OPEN_LEAKED\n\nuse OPEN_LEAKED\n"))),(0,i.kt)("h2",{id:"design-thoughts"},"Design thoughts"),(0,i.kt)("p",null,"The database deisgn is based on the concept that each real-world breach is unique, but the associated data is not.\nThis means that a ",(0,i.kt)("inlineCode",{parentName:"p"},"searchable"),", such as a username, email, password or domain may be present in multiple databreaches.\nThis approach allows us to establish the required entity relationships for the application. During pre-processing of the data each searchable entity is assigned a unique ID by MariaDB, as is each individual breach."),(0,i.kt)("h3",{id:"data"},"Data"),(0,i.kt)("p",null,"Large tables are created each containing an ID for each type of ",(0,i.kt)("inlineCode",{parentName:"p"},"searchable")," entity and an id for a breach.\nIf a searchable entity appears in multiple breaches, its ID will be duplicated in the table, but the primary key will remain unique due to the different associated breach IDs.\nBy splitting up the entity types and using unique IDs, we can avoid searching through unnecessary records, resulting in faster query speeds.\nBy splitting the email into ",(0,i.kt)("inlineCode",{parentName:"p"},"local")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"domain")," we can easily filter and search based on the domain name alone. This significantly reduce the number of records tht need to be searched, resulting in faster query speeds.\nAdditionally it allows for a more targed searches, such as finding all breaches associated with a particular domain name."),(0,i.kt)("admonition",{type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"To ensure security, it is strongly advised to restrict the usage of domain search functionality to authorized users only. This is because it could be exploited by attackers to gather sensitive information about a domain.\nIt is recommended to implement a verification process that confirms the user is the owner or administrator of the domain.")),(0,i.kt)("h3",{id:"authorisations"},"Authorisations"),(0,i.kt)("p",null,"In the application, there are two tables ",(0,i.kt)("inlineCode",{parentName:"p"},"user"),"and ",(0,i.kt)("inlineCode",{parentName:"p"},"authorities"),", that are used for authentication. These tables are an based on the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/jdbc.html"},"JDBC Authentication")," base schema which is provided by\n",(0,i.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-security/reference/index.html"},"Spring Security"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," table contains the user's username, passwrod and whether the account is enabled or disabled.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"authorities")," table contains the user's role."),(0,i.kt)("p",null,"Our ",(0,i.kt)("inlineCode",{parentName:"p"},"user"),"table have been extended to also contain information regarding the student number or employee initials, and a full name.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"authorities")," remains to default values."),(0,i.kt)("h4",{id:"future-works"},"Future works"),(0,i.kt)("p",null,"A great idea for future development was perhabs to include the Single-Sign On system from DTU, to automaticly allow users access without them having to create an account."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Single sign on allows users to be authentication across sites by sending a special type of authentication token.\nThis can both be a vulnerability and a security boost based on the application.\nBy using the two-factor authentication from DTU, SSO could help in further securing this application")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Any major changes to the database would require removing the folder ",(0,i.kt)("inlineCode",{parentName:"p"},"db")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"root/MariaDB"),".\nThis rebuilds the entire database from the schema stated ",(0,i.kt)("a",{parentName:"p",href:"#loading-the-schemas"},"here"))))}h.isMDXComponent=!0},34641:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/files/ERD_diagram.drawio-812acb15ac1c88f7891c1ce7aaaec176.pdf"},53182:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/files/users_ERD-6c730b86b7d3bf0632cd982c32379fb6.pdf"}}]);